const fs  = require ('fs')

const path  = require ('path')

const color = require('../Util/Colors')

const GinkoError = require('../Util/GinkoError')

module.exports = { 

CommandModule(commandFolder, commands, options , util) { 

var arch2 = [];

        try{
        var files =  fs.readdirSync(commandFolder)
        }catch (e)  {throw new GinkoError('Ruta de comandos invalida') }
          
            files.forEach( fil => {

                if(fs.lstatSync(commandFolder + '/' + fil).isDirectory()) {

                    var file = fs.readdirSync(commandFolder + '/' + fil)
                            
                    file.forEach( fill2 => {
                                
                        arch2.push(`/${fil}/${fill2}`)
                               
                    })     
                }
            })
            
                let arch = files.filter(f => f.split(".").pop() === "js");
        
                var finalFiles = arch.concat(arch2); 
           
                if (finalFiles.length <= 0) throw new GinkoError('No pude cargar ningun comando')
                
            
                console.log(`${color.BgBlue}Comandos:${color.Reset} ${finalFiles.length}`);
           
                finalFiles.forEach(f  => {
               
                    let pp = require(path.resolve(commandFolder) + `/${f}`);

                    if(!pp.nombre) throw new GinkoError('Todos los comandos tienen que tener el nombre definido')

                    commands.set(pp.nombre , pp.run);
                    options.push({nombre: pp.nombre, ownerOnly: pp.soloOwner, cooldown: pp.cooldown , alias: pp.alias , permiso: pp.permiso})
                    util.push({nombre: pp.nombre, desc: pp.descripcion , cat: pp.categoria , uso: pp.uso, alias: pp.alias})
                })
          
            }

        }